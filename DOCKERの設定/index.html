<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>DOCKERの設定 - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">コンテンツ一覧</a>
                            </li>
                            <li class="nav-item">
                                <a href="../AWS%20Tips/" class="nav-link">AWS Tips</a>
                            </li>
                            <li class="nav-item">
                                <a href="../CentOS/" class="nav-link">CentOS</a>
                            </li>
                            <li class="nav-item">
                                <a href="../DOALR/" class="nav-link">DOALR</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">DOCKERの設定</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Generative%20AI%20Use%20Cases%20JP%E3%81%AE%E6%A7%8B%E7%AF%89/" class="nav-link">Generative AI Use Cases JPの構築</a>
                            </li>
                            <li class="nav-item">
                                <a href="../MacOSX/" class="nav-link">MacOSX</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Skyrim/" class="nav-link">Skyrim</a>
                            </li>
                            <li class="nav-item">
                                <a href="../SkyrimATF/" class="nav-link">SkyrimATF</a>
                            </li>
                            <li class="nav-item">
                                <a href="../debian/" class="nav-link">Debian</a>
                            </li>
                            <li class="nav-item">
                                <a href="../skyrimSE/" class="nav-link">skyrimSE</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../DOALR/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Generative%20AI%20Use%20Cases%20JP%E3%81%AE%E6%A7%8B%E7%AF%89/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#docker" class="nav-link">Docker運用手順</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#dockerwindows11-wsl2" class="nav-link">Dockerインストール手順（Windows11 WSL2）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#docker_1" class="nav-link">Docker運用手順</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#dockerwindows11-wsl2_1" class="nav-link">Dockerインストール手順（Windows11 WSL2）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dockeraws-ec2" class="nav-link">Dockerインストール手順（AWS EC2）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#docker_2" class="nav-link">DOCKERコンテナ</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pukiwikidocker" class="nav-link">pukiwikiをDockerコンテナでインストール</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pukiwiki" class="nav-link">pukiwiki設定</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dify" class="nav-link">Difyインストール</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_1" class="nav-link">関連ツール</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#aiwarp" class="nav-link">AIターミナル「warp」</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#amdwslamd-software" class="nav-link">AMDドライバ更新（WSL対応はAMD Software）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dockeraws-ec2_1" class="nav-link">Dockerインストール手順（AWS EC2）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#docker_3" class="nav-link">DOCKERコンテナ</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pukiwikidocker_1" class="nav-link">pukiwikiをDockerコンテナでインストール</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pukiwiki_1" class="nav-link">pukiwiki設定</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dify_1" class="nav-link">Difyインストール</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_2" class="nav-link">関連ツール</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#aiwarp_1" class="nav-link">AIターミナル「warp」</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#amdwslamd-software_1" class="nav-link">AMDドライバ更新（WSL対応はAMD Software）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>[[FrontPage]]</p>
<h1 id="docker">Docker運用手順</h1>
<h2 id="dockerwindows11-wsl2">Dockerインストール手順（Windows11 WSL2）</h2>
<p>-Ubuntu 20.04 をアップデートする 
 $ sudo apt update[[FrontPage]]</p>
<h1 id="docker_1">Docker運用手順</h1>
<h2 id="dockerwindows11-wsl2_1">Dockerインストール手順（Windows11 WSL2）</h2>
<p>-Ubuntu 20.04 をアップデートする 
 $ sudo apt update
 $ sudo apt upgrade -y
-必要なパッケージをインストールする 
 $ sudo apt install curl -y
 $ sudo apt install apt-transport-https -y
-Docker 公式 GPG 鍵を追加 
 $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
-Docker 安定版のレポジトリを追加 
 $ echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
-レポジトリをアップデートし、Docker Engine をインストール 
 $ sudo apt update
 $ sudo apt install docker-ce docker-ce-cli containerd.io -y
-docker-compose もインストール 
 $ sudo apt install docker-compose -y
-Docker デーモンを起動 
 $ sudo service docker start
-Docker の容量の削減
 $ docker system df                # Docker の使用容量や割合の表示
 $ docker ps -a                    # コンテナの表示
 $ docker images                   # イメージの表示
 $ docker image prune              # 使っていないイメージの削除
 $ docker system prune             # すべてを全削除
 $ docker builder prune            # ビルドキャッシュの全削除
 $ docker rm $(docker ps -aq)      # コンテナの全削除
 $ docker rmi $(docker images -q)  # イメージの全削除
 $ docker rmi <Image ID>           # 各イメージの削除</p>
<p>-参考リンク 
--<a href="https://qiita.com/taka777n/items/ea3a1b3a2802aabf3db2">windowsにWSL2+Docker環境を構築する手順</a>
--<a href="https://wisenetwork.net/archives/2642">【2024年最新版】初心者のためのpukiwikiのインストール方法と使い方</a>
--<a href="https://zenn.dev/anko/articles/976d904e53d87e">Windows / WSL2 の容量を減らす方法</a></p>
<h2 id="dockeraws-ec2">Dockerインストール手順（AWS EC2）</h2>
<p>-EC2内のパッケージを最新にしておく
 $ sudo yum update -y
-Docker Engineパッケージのインストール
 $ sudo yum install -y docker
-Dockerサービスの起動
 $ sudo systemctl start docker
-Dockerサービスが起動していることを確認。[active (running)]と表示されていれば正常に起動している
 $ systemctl status docker
 ● docker.service - Docker Application Container Engine
    Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
    Active: active (running) since Sat 2022-06-11 23:45:40 UTC; 5s ago
-Dockerサービスの自動起動を有効化
 $ sudo systemctl enable docker
 Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
-Dockerサービスの自動起動が有効であることを確認。[enabled]と表示されていればOK
 $ systemctl is-enabled docker
 enabled
-ec2-userにdockerグループを追加（Dockerをインストールすると、OSにdockerグループが自動作成される）、これでec2-userはsudoなしでdockerコマンドを実行できるようになる
 $ grep docker /etc/group
 docker:x:992:
 $ sudo usermod -a -G docker ec2-user
-Docker Composeのインストール</p>
<p>-参考リンク
--<a href="https://kacfg.com/aws-ec2-docker/">【AWS】EC2にDockerとDocker Composeをインストール</a>
--<a href="https://zenn.dev/quantum/articles/b1de629aca3cf0">パソコン起動時にWSLのdocker composeを自動起動させる</a></p>
<h2 id="docker_2">DOCKERコンテナ</h2>
<p>-実行中のコンテナ名を確認
 $ docker ps
-コンテナにログイン
 $ docker exec -it {コンテナ名} sh
-あるいは、docker-compose.ymlを作成
 services:
   pukiwiki:
     image: pengo/pukiwiki
     restart: unless-stopped
     ports:
       - 8080:80
     volumes:
      - $HOME/DOCKER/pukiwiki:/ext
--pukiwiki起動
 $ docker compose up -d
--pukiwiki停止
 $ docker compose down -v</p>
<p>-参考リンク
--<a href="https://hub.docker.com/r/pengo/pukiwiki">pukiwiki用Dockerコンテナ</a>
--<a href="https://qiita.com/smats-rd/items/3bdd70ce2de4e65cf0f0">Pukiwiki 用 Dockerコンテナを触ってみたメモ</a>
--<a href="https://saturday-in-the-park.netlify.app/AlpineLinux/12_PikiWiki/">PukiWikiのインストール</a>
--<a href="https://qiita.com/shimada_slj/items/3580b0426fa6b73e4638">【Docker Compose】今更聞けない、docker-compose.ymlの書き方や仕組み</a>
--<a href="https://qiita.com/ryome/items/35df47a01a7fe3ac70ee">Docker-compose基礎</a></p>
<h2 id="pukiwikidocker">pukiwikiをDockerコンテナでインストール</h2>
<p>-インストール手順
--vオプションを省略すればマウントしない
 mkdir $HOME/pukiwiki
 docker run -p 8080:80 -v $HOME/pukiwiki:/ext -d pengo/pukiwiki
 open http://localhost:8080</p>
<p>-データの転送方法
サーバー側の$HOME/pukiwikiに設定ファイル等ができており、以下のフォルダ部分を移設すれば利用できる。
 wiki/ : データ本体
 attach/ : 添付ファイル
 cache/ : 最近の更新
 diff/ : 更新履歴</p>
<p>-pukiwikiのアンインストール方法
--展開したフォルダごと削除すればアンインストール完了</p>
<h2 id="pukiwiki">pukiwiki設定</h2>
<p>-pukiwiki.ini.phpを編集し、管理者パスワードを設定する（"!"の部分にmd5で暗号化し記入）
 $adminpass = '{x-php-md5}!';
-バックアップの出力（管理者パスワードが必要）
 http://localhost:8080/?cmd=dump</p>
<p>-参考リンク
--<a href="https://www.kisnet.or.jp/~kanou/?Web+Collaboration+by+PukiWik-pukiwiki%E3%81%A7%E5%87%8D%E7%B5%90%E3%81%97%E3%81%9F%E8%A8%98%E4%BA%8B%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%8C%E6%B6%88%E3%81%88%E3%82%8B%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Web Collaboration by PukiWik-pukiwikiで凍結した記事の内容が消える件について</a>
--<a href="https://dev.digitra.net/tools/md5encode.php">md5変換ツール</a>
--<a href="https://qiita.com/saitohsan/items/84960a23b2a9c3e35a27">pukiwiki新規設置時の改修点メモ（2020年版）</a>
--<a href="https://pukiwiki.sourceforge.io/?PukiWiki/Install/%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%AD%E5%AE%9A">PukiWiki/Install/パーミッション設定</a>
--<a href="https://tetsuyai.hatenablog.com/entry/20080727">PukiWikiの管理パスワードとユーザー認証設定の更新</a>
--<a href="https://wiki.dobon.net/index.php?PukiWiki%2FTips%2F%A5%C7%A1%BC%A5%BF%A4%F2%A5%D0%A5%C3%A5%AF%A5%A2%A5%C3%A5%D7%A1%A2%A5%EA%A5%B9%A5%C8%A5%A2%A4%B9%A4%EB">データをバックアップ、リストアする</a></p>
<h2 id="dify">Difyインストール</h2>
<p>-Dify導入
 $ git clone https://github.com/langgenius/dify.git
-Dify起動
 $ cp .env.example .env
 $ docker compose up -d
-http://localhost/install にアクセス。</p>
<p>--ollama導入（テスト、AMD ROCm導入で失敗）
---AMD GPU用
 $ docker run -d --device /dev/kfd --device /dev/dri -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama:rocm
---コンテナーに入る
 $ docker exec -it ollama bash
---Llama3 8Bのダウンロード
 ollama run llama3
---Ollamaを終了させる -&gt; 起動したOllamaは「/bye」と入力すると終了できる
---コンテナーを抜ける
 exit
---ollama削除
 $ docker rm ollama</p>
<p>--AWS Bedrock接続
---AWS CLIが設定したローカル環境のアクセスキーを取得する
 $ cat ~/.aws/credentials 
 [default]
 aws_access_key_id = XXXXXXXXXXXX
 aws_secret_access_key = XXXXXXXXXXXX
--Dify設定画面に入力（モデルIDは anthropic.claude-3-5-haiku-20241022-v1:0 など）</p>
<p>-参考リンク
--<a href="https://qiita.com/yuki_ink/items/1367e0b2bb09c95c0570#4-dify-%E5%B0%8E%E5%85%A5">プロキシ環境下のローカルPCに "Dify" を導入して、Bedrockする</a>
--<a href="https://qiita.com/potofo/items/62136d2e4a5ea2f65c25">Dify（ディファイ）on WSL2でgpt-4oを実験</a>
--<a href="https://qiita.com/Tadataka_Takahashi/items/ba832511bd4fd5cd46f1">ノーコードLLM統合アプリのdifyでollamaと連携してみた</a>
--<a href="https://touch-sp.hatenablog.com/entry/2024/05/12/110240">【Dify】【Ollama】【WSL2】Difyをローカル環境で実行するまでの全手順</a>
^^<a href="https://hub.docker.com/r/ollama/ollama">ollama用Dockerコンテナ</a>
--<a href="https://qiita.com/harumaki-web/items/f7ec46cb5f6b7b5a9cc3">ローカル環境でIAMロール権限を取得する</a>
--<a href="https://zenn.dev/metalmental/articles/20241003_dify">Dify導入 個人メモ</a></p>
<h1 id="_1">関連ツール</h1>
<h2 id="aiwarp">AIターミナル「warp」</h2>
<p>-WSLにインストール
 $ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
 $ sudo apt -y install ./google-chrome-stable_current_amd64.deb
-~/.bash_profileに追加
 export WARP_ENABLE_WAYLAND=1
 export MESA_D3D12_DEFAULT_ADAPTER_NAME=NVIDIA
 export BROWSER=google-chrome
-warp起動
 $ warp-terminal</p>
<p>-参考リンク
--<a href="https://www.warp.dev/">The intelligent terminal. Warp</a>
--<a href="https://dev.to/karleeov/warp-terminal-on-wsl-is-amazing-5bj4">WSLのワープターミナルは素晴らしいです</a>
--<a href="https://qiita.com/shun_sakamoto/items/a0c79083c97064a361f2">知らないなんてもったいない！次世代ターミナル「Warp」</a>
--<a href="https://zenn.dev/collabostyle/articles/00706975b8a29e">ターミナル「Warp」の便利機能とショートカットキー</a></p>
<h2 id="amdwslamd-software">AMDドライバ更新（WSL対応は<a href="Adrenalin Edition™ 24.12.1 for WSL2:https://www.amd.com/en/resources/support-articles/release-notes/RN-RAD-WIN-24-12-1.html">AMD Software</a>）</h2>
<p>-<a href="https://rocm.docs.amd.com/projects/radeon/en/latest/docs/install/wsl/install-radeon.html">ROCmを使用したWSL用のRadeonソフトウェアのインストール</a>
 $ sudo apt update
 $ wget https://repo.radeon.com/amdgpu-install/6.1.3/ubuntu/jammy/amdgpu-install_6.1.60103-1_all.deb
 $ sudo apt install ./amdgpu-install_6.1.60103-1_all.deb
-使用可能なユースケースのリストを表示
 $ sudo amdgpu-install --list-usecase
-WSL のユース ケース # AMDでは、デフォルトでWSLユースケースをインストールすることをお勧めします。次のコマンドを実行して、オープンソースのグラフィックスとROCmをインストールします。
 $ amdgpu-install -y --usecase=wsl,rocm --no-dkms
-インストール後の確認チェック
 $ rocminfo
失敗している模様。
 hsa api call failure at: ./sources/wsl/tools/rocminfo/rocminfo.cc:1087
 Call returned HSA_STATUS_ERROR_OUT_OF_RESOURCES: The runtime failed to allocate the necessary resources. This error may also occur when the core runtime library needs to spawn threads or create internal OS-specific events.
-ROCmのアンインストール。次のコマンドを実行して、ROCmソフトウェアスタックおよびその他のLinux用Radeonソフトウェアコンポーネントをアンインストール。
 $ sudo amdgpu-uninstall</p>
<p>-参考リンク
--<a href="https://repo.radeon.com/amdgpu-install/6.1.3/ubuntu/jammy/">Release notes amdgpu-install</a>
--<a href="Adrenalin Edition 24.12.1 Release Notes:https://www.amd.com/en/resources/support-articles/release-notes/RN-RAD-WIN-24-12-1.html">AMD Software</a>
--<a href=":https://rocm.docs.amd.com/projects/radeon/en/latest/docs/install/wsl/install-radeon.html">ROCmを使用したWSL用のRadeonソフトウェアのインストール</a>
--<a href="https://capeta55.xsrv.jp/how-to-run-amd-rocm-on-windows11/">Windows11でAMD ROCmソフトウェアを実行する方法</a></p>
<p>$ sudo apt upgrade -y
-必要なパッケージをインストールする 
 $ sudo apt install curl -y
 $ sudo apt install apt-transport-https -y
-Docker 公式 GPG 鍵を追加 
 $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
-Docker 安定版のレポジトリを追加 
 $ echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
-レポジトリをアップデートし、Docker Engine をインストール 
 $ sudo apt update
 $ sudo apt install docker-ce docker-ce-cli containerd.io -y
-docker-compose もインストール 
 $ sudo apt install docker-compose -y
-Docker デーモンを起動 
 $ sudo service docker start
-Docker の容量の削減
 $ docker system df                # Docker の使用容量や割合の表示
 $ docker ps -a                    # コンテナの表示
 $ docker images                   # イメージの表示
 $ docker image prune              # 使っていないイメージの削除
 $ docker system prune             # すべてを全削除
 $ docker builder prune            # ビルドキャッシュの全削除
 $ docker rm $(docker ps -aq)      # コンテナの全削除
 $ docker rmi $(docker images -q)  # イメージの全削除
 $ docker rmi <Image ID>           # 各イメージの削除</p>
<p>-参考リンク 
--<a href="https://qiita.com/taka777n/items/ea3a1b3a2802aabf3db2">windowsにWSL2+Docker環境を構築する手順</a>
--<a href="https://wisenetwork.net/archives/2642">【2024年最新版】初心者のためのpukiwikiのインストール方法と使い方</a>
--<a href="https://zenn.dev/anko/articles/976d904e53d87e">Windows / WSL2 の容量を減らす方法</a></p>
<h2 id="dockeraws-ec2_1">Dockerインストール手順（AWS EC2）</h2>
<p>-EC2内のパッケージを最新にしておく
 $ sudo yum update -y
-Docker Engineパッケージのインストール
 $ sudo yum install -y docker
-Dockerサービスの起動
 $ sudo systemctl start docker
-Dockerサービスが起動していることを確認。[active (running)]と表示されていれば正常に起動している
 $ systemctl status docker
 ● docker.service - Docker Application Container Engine
    Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
    Active: active (running) since Sat 2022-06-11 23:45:40 UTC; 5s ago
-Dockerサービスの自動起動を有効化
 $ sudo systemctl enable docker
 Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
-Dockerサービスの自動起動が有効であることを確認。[enabled]と表示されていればOK
 $ systemctl is-enabled docker
 enabled
-ec2-userにdockerグループを追加（Dockerをインストールすると、OSにdockerグループが自動作成される）、これでec2-userはsudoなしでdockerコマンドを実行できるようになる
 $ grep docker /etc/group
 docker:x:992:
 $ sudo usermod -a -G docker ec2-user
-Docker Composeのインストール</p>
<p>-参考リンク
--<a href="https://kacfg.com/aws-ec2-docker/">【AWS】EC2にDockerとDocker Composeをインストール</a>
--<a href="https://zenn.dev/quantum/articles/b1de629aca3cf0">パソコン起動時にWSLのdocker composeを自動起動させる</a></p>
<h2 id="docker_3">DOCKERコンテナ</h2>
<p>-実行中のコンテナ名を確認
 $ docker ps
-コンテナにログイン
 $ docker exec -it {コンテナ名} sh
-あるいは、docker-compose.ymlを作成
 services:
   pukiwiki:
     image: pengo/pukiwiki
     restart: unless-stopped
     ports:
       - 8080:80
     volumes:
      - $HOME/DOCKER/pukiwiki:/ext
--pukiwiki起動
 $ docker compose up -d
--pukiwiki停止
 $ docker compose down -v</p>
<p>-参考リンク
--<a href="https://hub.docker.com/r/pengo/pukiwiki">pukiwiki用Dockerコンテナ</a>
--<a href="https://qiita.com/smats-rd/items/3bdd70ce2de4e65cf0f0">Pukiwiki 用 Dockerコンテナを触ってみたメモ</a>
--<a href="https://saturday-in-the-park.netlify.app/AlpineLinux/12_PikiWiki/">PukiWikiのインストール</a>
--<a href="https://qiita.com/shimada_slj/items/3580b0426fa6b73e4638">【Docker Compose】今更聞けない、docker-compose.ymlの書き方や仕組み</a>
--<a href="https://qiita.com/ryome/items/35df47a01a7fe3ac70ee">Docker-compose基礎</a></p>
<h2 id="pukiwikidocker_1">pukiwikiをDockerコンテナでインストール</h2>
<p>-インストール手順
--vオプションを省略すればマウントしない
 mkdir $HOME/pukiwiki
 docker run -p 8080:80 -v $HOME/pukiwiki:/ext -d pengo/pukiwiki
 open http://localhost:8080</p>
<p>-データの転送方法
サーバー側の$HOME/pukiwikiに設定ファイル等ができており、以下のフォルダ部分を移設すれば利用できる。
 wiki/ : データ本体
 attach/ : 添付ファイル
 cache/ : 最近の更新
 diff/ : 更新履歴</p>
<p>-pukiwikiのアンインストール方法
--展開したフォルダごと削除すればアンインストール完了</p>
<h2 id="pukiwiki_1">pukiwiki設定</h2>
<p>-pukiwiki.ini.phpを編集し、管理者パスワードを設定する（"!"の部分にmd5で暗号化し記入）
 $adminpass = '{x-php-md5}!';
-バックアップの出力（管理者パスワードが必要）
 http://localhost:8080/?cmd=dump</p>
<p>-参考リンク
--<a href="https://www.kisnet.or.jp/~kanou/?Web+Collaboration+by+PukiWik-pukiwiki%E3%81%A7%E5%87%8D%E7%B5%90%E3%81%97%E3%81%9F%E8%A8%98%E4%BA%8B%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%8C%E6%B6%88%E3%81%88%E3%82%8B%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Web Collaboration by PukiWik-pukiwikiで凍結した記事の内容が消える件について</a>
--<a href="https://dev.digitra.net/tools/md5encode.php">md5変換ツール</a>
--<a href="https://qiita.com/saitohsan/items/84960a23b2a9c3e35a27">pukiwiki新規設置時の改修点メモ（2020年版）</a>
--<a href="https://pukiwiki.sourceforge.io/?PukiWiki/Install/%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%AD%E5%AE%9A">PukiWiki/Install/パーミッション設定</a>
--<a href="https://tetsuyai.hatenablog.com/entry/20080727">PukiWikiの管理パスワードとユーザー認証設定の更新</a>
--<a href="https://wiki.dobon.net/index.php?PukiWiki%2FTips%2F%A5%C7%A1%BC%A5%BF%A4%F2%A5%D0%A5%C3%A5%AF%A5%A2%A5%C3%A5%D7%A1%A2%A5%EA%A5%B9%A5%C8%A5%A2%A4%B9%A4%EB">データをバックアップ、リストアする</a></p>
<h2 id="dify_1">Difyインストール</h2>
<p>-Dify導入
 $ git clone https://github.com/langgenius/dify.git
-Dify起動
 $ cp .env.example .env
 $ docker compose up -d
-http://localhost/install にアクセス。</p>
<p>--ollama導入（テスト、AMD ROCm導入で失敗）
---AMD GPU用
 $ docker run -d --device /dev/kfd --device /dev/dri -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama:rocm
---コンテナーに入る
 $ docker exec -it ollama bash
---Llama3 8Bのダウンロード
 ollama run llama3
---Ollamaを終了させる -&gt; 起動したOllamaは「/bye」と入力すると終了できる
---コンテナーを抜ける
 exit
---ollama削除
 $ docker rm ollama</p>
<p>--AWS Bedrock接続
---AWS CLIが設定したローカル環境のアクセスキーを取得する
 $ cat ~/.aws/credentials 
 [default]
 aws_access_key_id = XXXXXXXXXXXX
 aws_secret_access_key = XXXXXXXXXXXX
--Dify設定画面に入力（モデルIDは anthropic.claude-3-5-haiku-20241022-v1:0 など）</p>
<p>-参考リンク
--<a href="https://qiita.com/yuki_ink/items/1367e0b2bb09c95c0570#4-dify-%E5%B0%8E%E5%85%A5">プロキシ環境下のローカルPCに "Dify" を導入して、Bedrockする</a>
--<a href="https://qiita.com/potofo/items/62136d2e4a5ea2f65c25">Dify（ディファイ）on WSL2でgpt-4oを実験</a>
--<a href="https://qiita.com/Tadataka_Takahashi/items/ba832511bd4fd5cd46f1">ノーコードLLM統合アプリのdifyでollamaと連携してみた</a>
--<a href="https://touch-sp.hatenablog.com/entry/2024/05/12/110240">【Dify】【Ollama】【WSL2】Difyをローカル環境で実行するまでの全手順</a>
^^<a href="https://hub.docker.com/r/ollama/ollama">ollama用Dockerコンテナ</a>
--<a href="https://qiita.com/harumaki-web/items/f7ec46cb5f6b7b5a9cc3">ローカル環境でIAMロール権限を取得する</a>
--<a href="https://zenn.dev/metalmental/articles/20241003_dify">Dify導入 個人メモ</a></p>
<h1 id="_2">関連ツール</h1>
<h2 id="aiwarp_1">AIターミナル「warp」</h2>
<p>-WSLにインストール
 $ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
 $ sudo apt -y install ./google-chrome-stable_current_amd64.deb
-~/.bash_profileに追加
 export WARP_ENABLE_WAYLAND=1
 export MESA_D3D12_DEFAULT_ADAPTER_NAME=NVIDIA
 export BROWSER=google-chrome
-warp起動
 $ warp-terminal</p>
<p>-参考リンク
--<a href="https://www.warp.dev/">The intelligent terminal. Warp</a>
--<a href="https://dev.to/karleeov/warp-terminal-on-wsl-is-amazing-5bj4">WSLのワープターミナルは素晴らしいです</a></p>
<h2 id="amdwslamd-software_1">AMDドライバ更新（WSL対応は<a href="Adrenalin Edition™ 24.12.1 for WSL2:https://www.amd.com/en/resources/support-articles/release-notes/RN-RAD-WIN-24-12-1.html">AMD Software</a>）</h2>
<p>-<a href="https://rocm.docs.amd.com/projects/radeon/en/latest/docs/install/wsl/install-radeon.html">ROCmを使用したWSL用のRadeonソフトウェアのインストール</a>
 $ sudo apt update
 $ wget https://repo.radeon.com/amdgpu-install/6.1.3/ubuntu/jammy/amdgpu-install_6.1.60103-1_all.deb
 $ sudo apt install ./amdgpu-install_6.1.60103-1_all.deb
-使用可能なユースケースのリストを表示
 $ sudo amdgpu-install --list-usecase
-WSL のユース ケース # AMDでは、デフォルトでWSLユースケースをインストールすることをお勧めします。次のコマンドを実行して、オープンソースのグラフィックスとROCmをインストールします。
 $ amdgpu-install -y --usecase=wsl,rocm --no-dkms
-インストール後の確認チェック
 $ rocminfo
失敗している模様。
 hsa api call failure at: ./sources/wsl/tools/rocminfo/rocminfo.cc:1087
 Call returned HSA_STATUS_ERROR_OUT_OF_RESOURCES: The runtime failed to allocate the necessary resources. This error may also occur when the core runtime library needs to spawn threads or create internal OS-specific events.
-ROCmのアンインストール。次のコマンドを実行して、ROCmソフトウェアスタックおよびその他のLinux用Radeonソフトウェアコンポーネントをアンインストール。
 $ sudo amdgpu-uninstall</p>
<p>-参考リンク
--<a href="https://repo.radeon.com/amdgpu-install/6.1.3/ubuntu/jammy/">Release notes amdgpu-install</a>
--<a href="Adrenalin Edition 24.12.1 Release Notes:https://www.amd.com/en/resources/support-articles/release-notes/RN-RAD-WIN-24-12-1.html">AMD Software</a>
--<a href=":https://rocm.docs.amd.com/projects/radeon/en/latest/docs/install/wsl/install-radeon.html">ROCmを使用したWSL用のRadeonソフトウェアのインストール</a>
--<a href="https://capeta55.xsrv.jp/how-to-run-amd-rocm-on-windows11/">Windows11でAMD ROCmソフトウェアを実行する方法</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
